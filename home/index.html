<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title></title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width">

        <!-- Place favicon.ico and apple-touch-icon.png in the root directory -->

        <link rel="stylesheet" href="css/normalize.css">
        <link rel="stylesheet" href="css/main.css">
        <script src="js/vendor/modernizr-2.6.2.min.js"></script>
    </head>
    <body>
        <div id="fb-root"></div>
        <script>
          window.fbAsyncInit = function() {
            // init the FB JS SDK
            FB.init({
              appId      : '601523516531626', // App ID from the App Dashboard
              channelUrl : 'channel.html', // Channel File for x-domain communication
              status     : true, // check the login status upon init?
              cookie     : true, // set sessions cookies to allow your server to access the session?
              xfbml      : true  // parse XFBML tags on this page?
            });

            //Initialization Code
            FB.getLoginStatus(function(response) {
              if (response.status === 'connected') {
                // the user is logged in and has authenticated your
                // app, and response.authResponse supplies
                // the user's ID, a valid access token, a signed
                // request, and the time the access token 
                // and signed request each expire
                console.log("logged in");
                //USING SHITTY GLOBAL VARIABLES
                uid = response.authResponse.userID;
                accessToken = response.authResponse.accessToken;

                FB.api("/me/friends?access_token=" + accessToken , 'get', function(response) {
                  if (!response || response.error) {
                    alert(response.error['message']);
                    return;
                  } else {
                    friendsList = response;
                    console.log(friendsList);
                  }

                var batchRequest = []
                var friendsRequest = []

                for(var i = 0; i < 10; i++){
                  var offset = Math.floor(Math.random() * 500)
                  var friendId = friendsList.data[Math.floor(Math.random() * friendsList.data.length)].id
                  friendsRequest[i] = friendId;
                  batchRequest[i] = { "method" : "GET", "relative_url" : friendId + "/photos?limit=1&offset=" + offset }
                }

                FB.api("/", "POST", { access_token : accessToken,
                  batch : batchRequest
                  }, function(response){
                    //console.log(response)
                    photos = []
                    for(var i = 0; i < response.length; i++){
                      var responseData = JSON.parse(response[i].body)
                      //console.log(responseData)
                      if(responseData.data[0]){
                        photos[i] = {url: responseData.data[0].source, friendid : friendsRequest[i] }
                      }
                    }
                    console.log(photos)
                })
                })


              } else if (response.status === 'not_authorized') {
                // the user is logged in to Facebook, 
                // but has not authenticated your app
                console.log("logged in but not authorized");
              } else {
                // the user isn't logged in to Facebook.
                console.log("not logged in");
              }
             });

          };

          // Load the SDK's source Asynchronously
          (function(d, debug){
             var js, id = 'facebook-jssdk', ref = d.getElementsByTagName('script')[0];
             if (d.getElementById(id)) {return;}
             js = d.createElement('script'); js.id = id; js.async = true;
             js.src = "//connect.facebook.net/en_US/all" + (debug ? "/debug" : "") + ".js";
             ref.parentNode.insertBefore(js, ref);
           }(document, /*debug*/ false));
        </script>


        <!--[if lt IE 7]>
            <p class="chromeframe">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">activate Google Chrome Frame</a> to improve your experience.</p>
        <![endif]-->

        <!-- Add your site or application content here -->
        <h4><a href="#" id="loginAction">Login With Facebook</a></h4>
        <h4><a href="#" id="appendButton">Append</a></h4>
        <div id="container">
            <div class="item"><img src="http://muslimmedianetwork.com/mmn/windows-live-pictures/CatsandIslam_C53D/cats_012.jpg" width="240px"></div>
            <div class="item"><img src="http://www.phlmetropolis.com/Cats.jpg" width="240px"></div>
            <div class="item"><img src="http://25.media.tumblr.com/tumblr_mbuypt8R0M1ri87b4o1_1280.jpg" width="240px"></div>            
            <div class="item"><img src="http://muslimmedianetwork.com/mmn/windows-live-pictures/CatsandIslam_C53D/cats_012.jpg" width="240px"></div>
            <div class="item"><img src="http://www.phlmetropolis.com/Cats.jpg" width="240px"></div>
            <div class="item"><img src="http://25.media.tumblr.com/tumblr_mbuypt8R0M1ri87b4o1_1280.jpg" width="240px"></div>            
            <div class="item"><img src="http://muslimmedianetwork.com/mmn/windows-live-pictures/CatsandIslam_C53D/cats_012.jpg" width="240px"></div>
            <div class="item"><img src="http://www.phlmetropolis.com/Cats.jpg" width="240px"></div>
            <div class="item"><img src="http://25.media.tumblr.com/tumblr_mbuypt8R0M1ri87b4o1_1280.jpg" width="240px"></div>            
            <div class="item"><img src="http://muslimmedianetwork.com/mmn/windows-live-pictures/CatsandIslam_C53D/cats_012.jpg" width="240px"></div>
            <div class="item"><img src="http://www.phlmetropolis.com/Cats.jpg" width="240px"></div>
            <div class="item"><img src="http://25.media.tumblr.com/tumblr_mbuypt8R0M1ri87b4o1_1280.jpg" width="240px"></div>            
            <div class="item"><img src="http://muslimmedianetwork.com/mmn/windows-live-pictures/CatsandIslam_C53D/cats_012.jpg" width="240px"></div>
            <div class="item"><img src="http://www.phlmetropolis.com/Cats.jpg" width="240px"></div>
            <div class="item"><img src="http://25.media.tumblr.com/tumblr_mbuypt8R0M1ri87b4o1_1280.jpg" width="240px"></div>
        </div>


        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js"></script>
        <script>window.jQuery || document.write('<script src="js/vendor/jquery-1.9.0.min.js"><\/script>')</script>
        <script src="js/plugins.js"></script>
        <script src="js/main.js"></script>

        <!-- Google Analytics: change UA-XXXXX-X to be your site's ID. -->
        <script>
            var _gaq=[['_setAccount','UA-XXXXX-X'],['_trackPageview']];
            (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
            g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
            s.parentNode.insertBefore(g,s)}(document,'script'));
        </script>
    </body>
</html>
